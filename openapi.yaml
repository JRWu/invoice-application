openapi: 3.0.3
info:
  title: Invoice Management API
  description: A comprehensive API for managing invoices, users, and generating reports
  version: 1.0.0
  contact:
    name: Invoice Application
    email: support@invoiceapp.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:5000/api
    description: Development server
  - url: https://api.invoiceapp.com/api
    description: Production server

security:
  - BearerAuth: []

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from login endpoint

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          example: "john_doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        company_name:
          type: string
          example: "Acme Corp"
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    Invoice:
      type: object
      properties:
        id:
          type: integer
          example: 1
        invoice_number:
          type: string
          example: "INV-20240115-A1B2C3D4"
        customer_name:
          type: string
          example: "ABC Company"
        customer_email:
          type: string
          format: email
          example: "contact@abccompany.com"
        customer_address:
          type: string
          example: "123 Main St, City, State 12345"
        issue_date:
          type: string
          format: date
          example: "2024-01-15"
        due_date:
          type: string
          format: date
          example: "2024-02-15"
        status:
          type: string
          enum: [draft, sent, paid, overdue]
          example: "draft"
        subtotal:
          type: number
          format: float
          example: 1000.00
        tax_rate:
          type: number
          format: float
          example: 8.5
        tax_amount:
          type: number
          format: float
          example: 85.00
        total_amount:
          type: number
          format: float
          example: 1085.00
        notes:
          type: string
          example: "Payment due within 30 days"
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        items:
          type: array
          items:
            $ref: '#/components/schemas/InvoiceItem'

    InvoiceItem:
      type: object
      properties:
        id:
          type: integer
          example: 1
        description:
          type: string
          example: "Web Development Services"
        quantity:
          type: number
          format: float
          example: 40.0
        unit_price:
          type: number
          format: float
          example: 25.00
        total:
          type: number
          format: float
          example: 1000.00

    Report:
      type: object
      properties:
        id:
          type: integer
          example: 1
        report_type:
          type: string
          enum: [monthly, quarterly, yearly, custom]
          example: "monthly"
        start_date:
          type: string
          format: date
          example: "2024-01-01"
        end_date:
          type: string
          format: date
          example: "2024-01-31"
        data:
          type: object
          properties:
            summary:
              type: object
              properties:
                total_invoices:
                  type: integer
                  example: 25
                total_revenue:
                  type: number
                  format: float
                  example: 15000.00
                paid_revenue:
                  type: number
                  format: float
                  example: 12000.00
                pending_revenue:
                  type: number
                  format: float
                  example: 2500.00
                overdue_revenue:
                  type: number
                  format: float
                  example: 500.00
                average_invoice_value:
                  type: number
                  format: float
                  example: 600.00
            status_breakdown:
              type: object
              properties:
                draft:
                  type: integer
                  example: 5
                sent:
                  type: integer
                  example: 8
                paid:
                  type: integer
                  example: 10
                overdue:
                  type: integer
                  example: 2
            monthly_data:
              type: array
              items:
                type: object
                properties:
                  month:
                    type: string
                    example: "January 2024"
                  count:
                    type: integer
                    example: 25
                  revenue:
                    type: number
                    format: float
                    example: 15000.00
            top_customers:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                    example: "ABC Company"
                  count:
                    type: integer
                    example: 5
                  revenue:
                    type: number
                    format: float
                    example: 5000.00
            date_range:
              type: object
              properties:
                start_date:
                  type: string
                  format: date
                  example: "2024-01-01"
                end_date:
                  type: string
                  format: date
                  example: "2024-01-31"
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    DashboardData:
      type: object
      properties:
        overview:
          type: object
          properties:
            total_invoices:
              type: integer
              example: 50
            total_revenue:
              type: number
              format: float
              example: 25000.00
            monthly_revenue:
              type: number
              format: float
              example: 5000.00
            paid_count:
              type: integer
              example: 30
            pending_count:
              type: integer
              example: 15
            overdue_count:
              type: integer
              example: 5
        recent_invoices:
          type: array
          items:
            $ref: '#/components/schemas/Invoice'

    Error:
      type: object
      properties:
        error:
          type: string
          example: "Invalid credentials"
        debug:
          type: string
          example: "Additional debug information"

    SuccessMessage:
      type: object
      properties:
        message:
          type: string
          example: "Operation completed successfully"

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check endpoint
      description: Check if the API is running
      security: []
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  message:
                    type: string
                    example: "Invoice API is running"

  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Create a new user account
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
              properties:
                username:
                  type: string
                  example: "john_doe"
                email:
                  type: string
                  format: email
                  example: "john@example.com"
                password:
                  type: string
                  format: password
                  example: "securePassword123"
                company_name:
                  type: string
                  example: "Acme Corp"
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User created successfully"
                  access_token:
                    type: string
                    example: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          description: Bad request (missing fields or user already exists)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and get access token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: "john_doe"
                password:
                  type: string
                  format: password
                  example: "securePassword123"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Login successful"
                  access_token:
                    type: string
                    example: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          description: Bad request (missing username or password)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/profile:
    get:
      tags:
        - Authentication
      summary: Get user profile
      description: Get the current user's profile information
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized (invalid or missing token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /invoices:
    get:
      tags:
        - Invoices
      summary: Get all invoices
      description: Retrieve all invoices for the authenticated user
      responses:
        '200':
          description: Invoices retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  invoices:
                    type: array
                    items:
                      $ref: '#/components/schemas/Invoice'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Invoices
      summary: Create a new invoice
      description: Create a new invoice with items
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - customer_name
                - due_date
                - items
              properties:
                customer_name:
                  type: string
                  example: "ABC Company"
                customer_email:
                  type: string
                  format: email
                  example: "contact@abccompany.com"
                customer_address:
                  type: string
                  example: "123 Main St, City, State 12345"
                due_date:
                  type: string
                  format: date
                  example: "2024-02-15"
                tax_rate:
                  type: number
                  format: float
                  example: 8.5
                notes:
                  type: string
                  example: "Payment due within 30 days"
                status:
                  type: string
                  enum: [draft, sent, paid, overdue]
                  example: "draft"
                items:
                  type: array
                  items:
                    type: object
                    required:
                      - description
                      - quantity
                      - unit_price
                    properties:
                      description:
                        type: string
                        example: "Web Development Services"
                      quantity:
                        type: number
                        format: float
                        example: 40.0
                      unit_price:
                        type: number
                        format: float
                        example: 25.00
      responses:
        '201':
          description: Invoice created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invoice created successfully"
                  invoice:
                    $ref: '#/components/schemas/Invoice'
        '400':
          description: Bad request (missing required fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /invoices/{invoice_id}:
    get:
      tags:
        - Invoices
      summary: Get a specific invoice
      description: Retrieve a specific invoice by ID
      parameters:
        - name: invoice_id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        '200':
          description: Invoice retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  invoice:
                    $ref: '#/components/schemas/Invoice'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Invoice not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Invoices
      summary: Update an invoice
      description: Update an existing invoice
      parameters:
        - name: invoice_id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                customer_name:
                  type: string
                  example: "ABC Company"
                customer_email:
                  type: string
                  format: email
                  example: "contact@abccompany.com"
                customer_address:
                  type: string
                  example: "123 Main St, City, State 12345"
                due_date:
                  type: string
                  format: date
                  example: "2024-02-15"
                tax_rate:
                  type: number
                  format: float
                  example: 8.5
                notes:
                  type: string
                  example: "Payment due within 30 days"
                status:
                  type: string
                  enum: [draft, sent, paid, overdue]
                  example: "sent"
                items:
                  type: array
                  items:
                    type: object
                    required:
                      - description
                      - quantity
                      - unit_price
                    properties:
                      description:
                        type: string
                        example: "Web Development Services"
                      quantity:
                        type: number
                        format: float
                        example: 40.0
                      unit_price:
                        type: number
                        format: float
                        example: 25.00
      responses:
        '200':
          description: Invoice updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invoice updated successfully"
                  invoice:
                    $ref: '#/components/schemas/Invoice'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Invoice not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Invoices
      summary: Delete an invoice
      description: Delete a specific invoice by ID
      parameters:
        - name: invoice_id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        '200':
          description: Invoice deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Invoice not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /reports:
    get:
      tags:
        - Reports
      summary: Get all reports
      description: Retrieve all reports for the authenticated user
      responses:
        '200':
          description: Reports retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  reports:
                    type: array
                    items:
                      $ref: '#/components/schemas/Report'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /reports/generate:
    post:
      tags:
        - Reports
      summary: Generate a new report
      description: Generate a new report for a specified date range
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - report_type
                - start_date
                - end_date
              properties:
                report_type:
                  type: string
                  enum: [monthly, quarterly, yearly, custom]
                  example: "monthly"
                start_date:
                  type: string
                  format: date
                  example: "2024-01-01"
                end_date:
                  type: string
                  format: date
                  example: "2024-01-31"
      responses:
        '201':
          description: Report generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Report generated successfully"
                  report:
                    $ref: '#/components/schemas/Report'
        '400':
          description: Bad request (missing required fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /reports/dashboard:
    get:
      tags:
        - Reports
      summary: Get dashboard data
      description: Get overview metrics and recent invoices for the dashboard
      responses:
        '200':
          description: Dashboard data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardData'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /reports/{report_id}:
    delete:
      tags:
        - Reports
      summary: Delete a report
      description: Delete a specific report by ID
      parameters:
        - name: report_id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        '200':
          description: Report deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Report not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

tags:
  - name: Health
    description: Health check endpoints
  - name: Authentication
    description: User authentication and profile management
  - name: Invoices
    description: Invoice management operations
  - name: Reports
    description: Report generation and dashboard data
